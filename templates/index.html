<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SeaDoc Checker — Document Forensics</title>
  <style>
    :root{
      --bg:#0b1220;--panel:#111827;--line:#1f2937;--ink:#e6edf3;--muted:#94a3b8;
      --chip:#0d1322;--chipLine:#243045;--accent:#2563eb;--good:#22c55e;--warn:#f59e0b;--bad:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif;margin:24px;background:var(--bg);color:var(--ink)}
    h1{margin:0 0 8px 0}
    .sub{opacity:.85;margin-bottom:16px;color:var(--muted)}
    .panel{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:16px;margin:12px 0}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(290px,1fr));gap:14px}
    .thumbs{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:8px}
    .imgbox{background:var(--chip);border:1px solid var(--chipLine);border-radius:10px;padding:8px}
    img{max-width:100%;border-radius:8px;display:block}
    .label{font-size:12px;opacity:.9;margin:6px 0 8px}
    .summary{font-size:13px;margin-top:8px}
    .summary strong{color:#cbd5e1}
    .footer{opacity:.7;font-size:12px;margin-top:22px;color:var(--muted)}
    .btn{background:var(--accent);border:none;color:white;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    input[type=file]{padding:8px;border-radius:10px;background:var(--bg);border:1px dashed #334155;color:var(--ink)}
    .row{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center}
    .hidden{display:none}

    .badge{display:inline-flex;align-items:center;font-weight:700;font-size:12px;border-radius:999px;padding:6px 10px;border:1px solid transparent}
    .sev-green{background:rgba(34,197,94,.12);color:var(--good);border-color:rgba(34,197,94,.35)}
    .sev-yellow{background:rgba(245,158,11,.12);color:var(--warn);border-color:rgba(245,158,11,.40)}
    .sev-red{background:rgba(239,68,68,.12);color:var(--bad);border-color:rgba(239,68,68,.40)}

    .icon-btn{display:inline-flex;align-items:center;justify-content:center;width:38px;height:38px;border-radius:10px;background:var(--accent);border:none}
    .icon-btn svg{display:block}

    .legend{display:flex;flex-wrap:wrap;gap:10px;margin-top:8px}
    .legend .item{display:inline-flex;gap:8px;align-items:center;font-size:12px;color:#cbd5e1}
    .swatch{width:16px;height:16px;border-radius:4px;border:1px solid #263247}
    .sw-add{background:linear-gradient(135deg,#3bf 0%,#ff0 50%,#f30 100%)}
    .sw-erase{background:#ff00ff}
    .sw-seam{background:#ff8a00}
    .sw-cm{background:#2bffb5}

    @media (max-width:720px){.row{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <h1>SeaDoc Checker</h1>
  <div class="sub">
    Upload JPG/PNG/PDF documents. We run Error Level Analysis and overlay “acid” highlights for suspicious areas, then show a short verdict.
    <div class="legend">
      <div class="item"><span class="swatch sw-add"></span><span>Add/Replace (ELA ⊕ noise)</span></div>
      <div class="item"><span class="swatch sw-erase"></span><span>Erase (low high‑freq in text)</span></div>
      <div class="item"><span class="swatch sw-seam"></span><span>Seam (paste boundary)</span></div>
      <div class="item"><span class="swatch sw-cm"></span><span>Copy–Move (duplicate)</span></div>
    </div>
  </div>

  <div class="panel">
    <form id="uploadForm" action="/analyze" method="post" enctype="multipart/form-data">
      <div class="row">
        <input id="fileInput" type="file" name="file" multiple required accept=".jpg,.jpeg,.png,.pdf">
        <button class="btn" type="submit">Upload & Analyze</button>
      </div>
    </form>
    {% if message %}
      <div class="sub" style="margin-top:8px">{{ message }}</div>
    {% endif %}
  </div>

  {% if results %}
  <div class="grid">
    {% for r in results %}
      <div class="panel">
        <div class="row" style="grid-template-columns:1fr auto;gap:8px;margin-bottom:8px">
          <div class="label">{{ r.label }}</div>
          {% if r.report %}
            <a class="icon-btn" href="{{ r.report }}?v={{ loop.index }}" download title="Download report">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 3v10m0 0l4-4m-4 4L8 9" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M4 14v4a2 2 0 002 2h12a2 2 0 002-2v-4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </a>
          {% endif %}
        </div>

        <div class="legend" style="margin:0 0 8px 0">
          <div class="item"><span class="swatch sw-add"></span><span>Add/Replace</span></div>
          <div class="item"><span class="swatch sw-erase"></span><span>Erase</span></div>
          <div class="item"><span class="swatch sw-seam"></span><span>Seam</span></div>
          <div class="item"><span class="swatch sw-cm"></span><span>Copy–Move</span></div>
        </div>

        {% if r.original %}
          {% if r.boxed or r.overlay %}
            <div class="row" style="grid-template-columns:auto auto;gap:8px;margin-bottom:8px">
              <button class="btn" type="button"
                onclick="const card=this.closest('.panel'); card.querySelectorAll('.view-original,.view-boxed').forEach(el=>el.classList.toggle('hidden'));">
                Toggle: Original ↔ Highlight
              </button>
            </div>
          {% endif %}
          <div class="imgbox view-original"><img loading="lazy" src="{{ r.original }}?v={{ loop.index }}" alt="Original page"></div>
        {% endif %}

        {% if r.ela %}
          <div class="imgbox" style="margin-top:8px"><img loading="lazy" src="{{ r.ela }}?v={{ loop.index }}" alt="ELA heatmap"></div>
        {% endif %}

        {% if r.boxed %}
          <div class="imgbox view-boxed hidden" style="margin-top:8px"><img loading="lazy" src="{{ r.boxed }}?v={{ loop.index }}" alt="Highlighted regions"></div>
        {% elif r.overlay %}
          <div class="imgbox view-boxed hidden" style="margin-top:8px"><img loading="lazy" src="{{ r.overlay }}?v={{ loop.index }}" alt="Highlighted regions"></div>
        {% endif %}

        {% if r.crops and r.crops|length > 0 %}
          <div style="margin-top:8px">
            <div class="label">Suspicious regions (thumbnails)</div>
            <div class="thumbs">
              {% for c in r.crops %}
                <div class="imgbox" title="#{{ c.index }} score={{ c.score }}">
                  <img loading="lazy" src="{{ c.url }}?v={{ loop.index }}-{{ c.index }}" alt="crop {{ c.index }}">
                </div>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        <div class="summary" style="margin-top:10px">
          {% set sev = (r.severity or 'green')|lower %}
          {% set badge_class = 'sev-green' if sev=='green' else ('sev-yellow' if sev=='yellow' else 'sev-red') %}
          <span class="badge {{ badge_class }}">{{ r.verdict or 'All good' }}</span>
          {% if r.regions %}
            <div style="margin-top:6px">Review the highlighted areas — likely edit candidates.</div>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
  {% endif %}

  <div class="footer">
    Tip: stamps, dates, and signatures often carry edits. Bright ELA clusters can indicate copy‑paste or retouch.
  </div>

  <script>
    // Client-side size check (server limit 25 MB per file)
    document.getElementById('uploadForm').addEventListener('submit', function (e) {
      const files = document.getElementById('fileInput').files;
      for (let f of files) {
        if (f.size > 25 * 1024 * 1024) {
          e.preventDefault();
          alert(`File ${f.name} is too large. Max 25 MB.`);
          return;
        }
      }
    });
  </script>
</body>
</html>
