<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SeaDoc Checker — Document Forensics</title>
  <style>
    :root{
      --bg:#0b1220;--panel:#111827;--line:#1f2937;--ink:#e6edf3;--muted:#94a3b8;
      --chip:#0d1322;--chipLine:#243045;--accent:#2563eb;--good:#34d399;--warn:#f59e0b;--bad:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif;
      margin:24px; background:var(--bg); color:var(--ink);
    }
    h1{margin:0 0 8px 0}
    .sub{opacity:.85; margin-bottom:16px; color:var(--muted)}
    .panel{background:var(--panel); border:1px solid var(--line); border-radius:14px; padding:16px; margin:12px 0}
    .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(290px,1fr)); gap:14px}
    .thumbs{display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); gap:8px}
    .imgbox{background:var(--chip); border:1px solid var(--chipLine); border-radius:10px; padding:8px}
    img{max-width:100%; border-radius:8px; display:block}
    .label{font-size:12px; opacity:.9; margin:6px 0 8px}
    .summary{font-size:13px; margin-top:8px}
    .summary strong{color:#cbd5e1}
    .verdict-low{color:var(--good)}
    .verdict-med{color:var(--warn)}
    .verdict-high{color:var(--bad)}
    .footer{opacity:.7; font-size:12px; margin-top:22px; color:var(--muted)}
    .btn{background:var(--accent); border:none; color:white; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600}
    .btn:disabled{opacity:.6; cursor:not-allowed}
    input[type=file]{padding:8px; border-radius:10px; background:var(--bg); border:1px dashed #334155; color:var(--ink)}
    details{background:#0c1426; border:1px solid #1e293b; border-radius:10px; padding:10px; margin-top:10px}
    summary{cursor:pointer; color:#cbd5e1}
    pre{white-space:pre-wrap; word-break:break-word; margin:8px 0 0 0}
    .row{display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center}
    @media (max-width:720px){.row{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <h1>SeaDoc Checker</h1>
  <div class="sub">Upload maritime documents (JPG/PNG/PDF). We’ll run ELA + noise scoring and highlight suspicious zones with thumbnails.</div>

  <div class="panel">
    <form id="uploadForm" action="/analyze" method="post" enctype="multipart/form-data">
      <div class="row">
        <input id="fileInput" type="file" name="file" multiple required accept=".jpg,.jpeg,.png,.pdf">
        <button class="btn" type="submit">Upload & Analyze</button>
      </div>
    </form>
    {% if message %}
      <div class="sub" style="margin-top:8px">{{ message }}</div>
    {% endif %}
  </div>

  {% if results %}
  <div class="grid">
    {% for r in results %}
      <div class="panel">
        <div class="label">{{ r.label }}</div>

        {% if r.original %}
          <div class="imgbox"><img src="{{ r.original }}" alt="Original"></div>
        {% endif %}

        {% if r.ela %}
          <div class="imgbox" style="margin-top:8px"><img src="{{ r.ela }}" alt="ELA"></div>
        {% endif %}

        {% if r.boxed %}
          <div class="imgbox" style="margin-top:8px"><img src="{{ r.boxed }}" alt="Overlay with boxes"></div>
        {% elif r.overlay %}
          <div class="imgbox" style="margin-top:8px"><img src="{{ r.overlay }}" alt="Overlay"></div>
        {% endif %}

        {% if r.crops and r.crops|length > 0 %}
          <div style="margin-top:8px">
            <div class="label">Suspicious regions (thumbnails)</div>
            <div class="thumbs">
              {% for c in r.crops %}
                <div class="imgbox" title="#{{ c.index }} score={{ c.score }}">
                  <img src="{{ c.url }}" alt="crop {{ c.index }}">
                </div>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        <div class="summary">
          {% set v = (r.verdict or '')|lower %}
          <div>
            <strong>Verdict:</strong>
            <span class="{% if 'review' in v %}verdict-med{% else %}verdict-low{% endif %}">
              {{ r.verdict or 'No issues found' }}
            </span>
          </div>
          {% if r.suspicious_percent is not none %}
            <div><strong>Suspicious area:</strong> {{ (r.suspicious_percent or 0)|round(1) }}%</div>
          {% endif %}
          <div><strong>Regions:</strong> {{ r.regions if r.regions is not none else 0 }}</div>
          {% if r.summary %}
            <div style="margin-top:6px">🔎 {{ r.summary }}</div>
          {% endif %}
        </div>

        <details>
          <summary>Raw</summary>
          <pre>{{ r | tojson(indent=2) }}</pre>
        </details>
      </div>
    {% endfor %}
  </div>
  {% endif %}

  <div class="footer">
    Tip: focus on stamps, dates and signatures — boxed areas show what needs human review.
  </div>

  <script>
    // фронтовая проверка размера (серверный лимит 25MB)
    document.getElementById('uploadForm').addEventListener('submit', function (e) {
      const files = document.getElementById('fileInput').files;
      for (let f of files) {
        if (f.size > 25 * 1024 * 1024) {
          e.preventDefault();
          alert(`File ${f.name} is too large. Max 25MB.`);
          return;
        }
      }
    });
  </script>
</body>
</html>
